# Obsidian WebDAV Uploader

一个智能、灵活的 Obsidian 插件，用于将拖入笔记的附件自动上传到 WebDAV 服务器。

它不仅是一个简单的上传工具，更专注于解决**多设备同步**与**本地/云端路径管理**的痛点。支持根据笔记位置自动规划云端目录，智能感知本地同步文件夹（如坚果云、Nextcloud），避免重复上传。

## ✨ 核心特性

- **📂 自动上传**：拖拽文件到笔记中，自动上传至 WebDAV 并插入链接。
- **🧠 智能同步感知**：如果拖入的文件位于您配置的本地同步盘中，插件会**直接生成链接**而不重复上传，节省带宽与空间。
- **🗺️ 灵活路径映射**：
    - **笔记路径模式**：让云端附件目录结构与您的 Obsidian 笔记目录结构保持一致。
    - **文件路径模式**：基于源文件的本地路径进行归档。
- **⚡️ 路径模拟器**：内置可视化模拟工具，输入路径即可预览文件将上传到何处，配置不再盲目。
- **🔄 去重机制**：云端已存在时可选择跳过上传。

## ⚙️ 配置指南

### 1. 基础设置
在插件设置页配置您的 WebDAV 服务器地址、用户名和密码。推荐点击「测试连接」确保配置正确。

### 2. 上传行为 (核心功能)

插件提供两种模式来决定文件上传后的存放位置：

#### 📝 模式 A：笔记路径 (推荐)
> 依据**当前编辑的笔记**所在的文件夹来决定上传路径。

*   **适用场景**：希望 WebDAV 上的附件目录与 Obsidian 笔记目录结构一一对应。
*   **配置方式**：
    1. 选择「路径决定方式」为 `笔记路径`。
    2. 在下方「笔记路径映射」中添加规则。
    3. **示例**：
        *   将 Obsidian 的 `Work` 文件夹映射到 WebDAV 的 `/MyDocs/Work`。
        *   此时在 `Work/ProjectA/Note.md` 中拖入图片，图片会自动上传到 `/MyDocs/Work/ProjectA/图片.png`。
    *   **未匹配规则**：如果笔记不在任何映射文件夹内，附件将上传到 WebDAV 根目录下对应的目录结构中。

#### 📂 模式 B：文件路径
> 依据**被拖入文件**在电脑上的绝对路径来决定。

*   **适用场景**：您的附件均来自固定的本地归档目录，或配合本地同步盘使用。
*   **配置方式**：
    1. 选择「路径决定方式」为 `文件路径`。
    2. 配置「本地同步文件夹」（必填）。
    3. **智能行为**：
        *   **在同步目录内**：如果文件在 `C:\Users\Name\坚果云` (已配置为同步目录)，插件计算出云端路径后，**仅插入链接**，不执行上传。
        *   **不在同步目录内**：插件会插入指向本地文件的 `file://` 链接，**不上传**（防止误上传私人文件到错误位置）。

## 🛠️ 使用技巧

### 路径模拟器
不确定配置是否生效？
1. 打开插件设置页底部的「路径模拟器」。
2. 输入一个本地文件路径。
3. (可选) 选择一个模拟的笔记位置。
4. 点击「模拟检查」，插件会告诉您：
    *   这个文件会被上传到哪？
    *   是否会触发“已存在跳过”？
    *   使用的是哪条映射规则？

## ⚠️ 注意事项
*   请确保 WebDAV 服务器支持 PUT 方法上传文件。
*   路径映射支持多条规则，插件会优先匹配路径最长（最精确）的规则。

## 🤝 贡献
欢迎提交 Issue 或 Pull Request！

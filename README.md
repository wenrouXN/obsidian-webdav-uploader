# Obsidian WebDAV Uploader

一个智能、灵活的 Obsidian 插件，用于将拖入笔记的附件自动上传到 WebDAV 服务器。

它不仅是一个简单的上传工具，更专注于解决**多设备同步**、**本地/云端路径管理**以及**图片预览**的痛点。

## ✨ 核心特性

- **📂 自动上传**：拖拽文件到笔记中，自动上传至 WebDAV 并插入链接。
- **🖼️ 即时预览**：**独家功能**！支持在 Obsidian 中直接渲染受密码保护的 WebDAV 图片（支持阅读视图 & 实时阅览模式），无需将图片下载到本地。
- **🧠 智能同步感知**：如果拖入的文件位于您配置的本地同步盘中，插件会**直接生成链接**而不重复上传，节省带宽与空间。
- **✏️ 交互式重命名**：拖入文件时可弹窗确认或修改链接显示的文字。
- **🗺️ 灵活路径映射**：
    - **笔记路径模式**：让云端附件目录结构与您的 Obsidian 笔记目录结构保持一致。
    - **文件路径模式**：基于源文件的本地路径进行归档。
- **⚡️ 路径模拟器**：内置可视化模拟工具，输入路径即可预览文件将上传到何处，配置不再盲目。

## ⚙️ 配置指南

### 1. 基础设置
在插件设置页配置您的 WebDAV 服务器地址、用户名和密码。推荐点击「测试连接」确保配置正确。

### 2. 核心功能配置

#### 🖼️ WebDAV 图片渲染
Obsidian 默认无法显示带有认证保护的 WebDAV 图片链接。本插件内置了渲染引擎，自动拦截 WebDAV 图片并使用您的凭据加载显示。
- **支持模式**：阅读视图 (Reading View)、实时阅览模式 (Live Preview)。
- **源码模式**：光标悬停在图片上时，会显示 `![name](url)` 源码方便编辑，移开后自动渲染为图片。
- **使用方法**：无需额外配置，只要配置好 WebDAV 账号即可生效。

#### 📝 路径决定模式
插件提供两种模式来决定文件上传后的存放位置：

**模式 A：笔记路径 (推荐)**
> 依据**当前编辑的笔记**所在的文件夹来决定上传路径。
- **适用场景**：希望 WebDAV 上的附件目录与 Obsidian 笔记目录结构一一对应。
- **配置示例**：将/Work 映射到 /WebDAV/Work。在 `Work/Note.md` 中拖入图片 -> 上传至 `/WebDAV/Work/Note/图片.png`。

**模式 B：文件路径**
> 依据**被拖入文件**在电脑上的绝对路径来决定。
- **适用场景**：配合本地同步盘（如坚果云、Nextcloud）使用。
- **配置方式**：设置「本地同步文件夹」。
- **智能行为**：
    - **在同步目录内**：文件已在云端同步目录中 -> **仅插入 WebDAV 链接**，不执行上传。
    - **不在同步目录内**：文件属于外部素材 -> **插入本地 file:// 链接**，不执行上传（避免误操作）。

### 3. 其他实用选项
- **拖拽时确认链接名称**：开启后，拖入文件时会弹出对话框，允许您自定义链接显示的文字（Alt Text）。
- **优先使用已存在文件**：上传前检查云端是否已有同名文件，如果有则直接使用，避免重复上传。

## 🛠️ 使用技巧

### 路径模拟器
不确定配置是否生效？
1. 打开插件设置页底部的「路径模拟器」。
2. 输入一个本地文件路径。
3. (可选) 选择一个模拟的笔记位置。
4. 点击「模拟检查」，插件会告诉您：
    *   这个文件会被上传到哪？
    *   是否会触发“已存在跳过”？
    *   使用的是哪条映射规则？

## ⚠️ 注意事项
*   请确保 WebDAV 服务器支持 PUT 方法上传文件。
*   路径映射支持多条规则，插件会优先匹配路径最长（最精确）的规则。

## 🤝 贡献
欢迎提交 Issue 或 Pull Request！
